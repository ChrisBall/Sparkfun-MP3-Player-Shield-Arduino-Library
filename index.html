<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>SFEMP3Shield: Arduino SFEMP3Shield Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">SFEMP3Shield
   &#160;<span id="projectnumber">1.00.00</span>
   </div>
   <div id="projectbrief">Arduino Library for VS10xx shield</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Arduino <a class="el" href="class_s_f_e_m_p3_shield.html" title="Interface Driver to the VS10xx chip on the SPI.">SFEMP3Shield</a> Library </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#Intro">Introduction</a></li>
<li class="level1"><a href="#Contributers">Contributers</a></li>
<li class="level1"><a href="#SDcard">SD\SDHC Cards</a></li>
<li class="level1"><a href="#Hardware">Hardware Configuration</a></li>
<li class="level1"><a href="#comment">Bugs and Comments</a></li>
<li class="level1"><a href="#SdFatClass">SdFat Usage</a></li>
<li class="level1"><a href="#References">References</a></li>
<li class="level1"><a href="#Installation">Installation</a></li>
<li class="level1"><a href="#Error_Codes">Error_Codes</a></li>
<li class="level1"><a href="#Plug_Ins">Plug Ins</a></li>
</ul>
</div>
<div class="textblock"><center>Copyright &copy; 2012 </center><h1><a class="anchor" id="Intro"></a>
Introduction</h1>
<p>The Arduino <a class="el" href="class_s_f_e_m_p3_shield.html" title="Interface Driver to the VS10xx chip on the SPI.">SFEMP3Shield</a> Library is a driver for VSLI's VS10xx, implemented as a Slave co-processor to audio decode streams of Ogg Vorbis/MP3/AAC/WMA/FLAC/WAVMIDI formats, across the SPI bus of the Arduino. Principally this library is developed for the VS1053, where it may be compatible with other VS10xx's</p>
<p>Initial development was implemented on an Arduino 328 UNO/Duemilanove with a SparkFun MP3 Player Shield. Where additional support has been provided for Seeduino MP3 Player Shield and documention is provied as to how to implement on a Arduino Mega. Where this driver is modular in concept to allow ready porting to other Arduino or Wiring platforms.</p>
<p>The main classes in <a class="el" href="class_s_f_e_m_p3_shield.html" title="Interface Driver to the VS10xx chip on the SPI.">SFEMP3Shield</a> is <a class="el" href="class_s_f_e_m_p3_shield.html" title="Interface Driver to the VS10xx chip on the SPI.">SFEMP3Shield</a>.</p>
<h1><a class="anchor" id="Contributers"></a>
Contributers</h1>
<dl class="section author"><dt>Author</dt><dd>Nathan Seidle, www.sparkfun.com </dd>
<dd>
Bill Porter, www.billporter.info </dd>
<dd>
Michael Flaga, www.flaga.net </dd>
<dd>
ddz </dd>
<dd>
Wade Brainerd</dd></dl>
<p>The <a class="el" href="class_s_f_e_m_p3_shield.html" title="Interface Driver to the VS10xx chip on the SPI.">SFEMP3Shield</a> use SdFile class</p>
<p>The SdVolume class supports FAT16 and FAT32 partitions. Most applications will not need to call SdVolume member function.</p>
<p>The Sd2Card class supports access to standard SD cards and SDHC cards. Most applications will not need to call Sd2Card functions. The Sd2Card class can be used for raw access to the SD card.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>speed up digitalwrites by using SdFat's atomwrite</dd></dl>
<p>An example is provided in the SFEMP3Shield/examples folder. Which is developed to test <a class="el" href="class_s_f_e_m_p3_shield.html" title="Interface Driver to the VS10xx chip on the SPI.">SFEMP3Shield</a> and illustrate its various common uses.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000002">Todo:</a></b></dt><dd>SdFat was developed for high speed data recording. SdFat was used to implement an audio record/play class, WaveRP, for the Adafruit Wave Shield. This application uses special Sd2Card calls to write to contiguous files in raw mode. These functions reduce write latency so that audio can be recorded with the small amount of RAM in the Arduino.</dd></dl>
<h1><a class="anchor" id="SDcard"></a>
SD\SDHC Cards</h1>
<p>Arduinos access SD cards using the cards SPI protocol. PCs, Macs, and most consumer devices use the 4-bit parallel SD protocol. A card that functions well on A PC or Mac may not work well on the Arduino.</p>
<p>Most cards have good SPI read performance but cards vary widely in SPI write performance. Write performance is limited by how efficiently the card manages internal erase/remapping operations. The Arduino cannot optimize writes to reduce erase operations because of its limit RAM.</p>
<p>SanDisk cards generally have good write performance. They seem to have more internal RAM buffering than other cards and therefore can limit the number of flash erase operations that the Arduino forces due to its limited RAM.</p>
<h1><a class="anchor" id="Hardware"></a>
Hardware Configuration</h1>
<p><a class="el" href="class_s_f_e_m_p3_shield.html" title="Interface Driver to the VS10xx chip on the SPI.">SFEMP3Shield</a> was developed using an <a href="http://www.sparkfun.com/">Sparkfun Electonics</a> <a href="https://www.sparkfun.com/products/10628">MP3 Player Shield DEV-10628</a>.</p>
<p>The hardware interface to the SD card should not use a resistor based level shifter. SdFat sets the SPI bus frequency to 8 MHz which results in signal rise times that are too slow for the edge detectors in many newer SD card controllers when resistor voltage dividers are used.</p>
<p>The 5 to 3.3 V level shifter for 5 V Arduinos should be IC based like the 74HC4050N based circuit shown in the file SdLevel.png. The Adafruit Wave Shield uses a 74AHC125N. Gravitech sells SD and MicroSD Card Adapters based on the 74LCX245.</p>
<p>If you are using a resistor based level shifter and are having problems try setting the SPI bus frequency to 4 MHz. This can be done by using card.init(SPI_HALF_SPEED) to initialize the SD card.</p>
<h1><a class="anchor" id="comment"></a>
Bugs and Comments</h1>
<p>If you wish to report bugs or have comments, send email to <a href="#" onclick="location.href='mai'+'lto:'+'fat'+'16'+'lib'+'@s'+'bcg'+'lo'+'bal'+'.n'+'et'; return false;">fat16<span style="display: none;">.nosp@m.</span>lib@<span style="display: none;">.nosp@m.</span>sbcgl<span style="display: none;">.nosp@m.</span>obal<span style="display: none;">.nosp@m.</span>.net</a>.</p>
<h1><a class="anchor" id="SdFatClass"></a>
SdFat Usage</h1>
<p>SdFat uses a slightly restricted form of short names. Only printable ASCII characters are supported. No characters with code point values greater than 127 are allowed. Space is not allowed even though space was allowed in the API of early versions of DOS.</p>
<p>Short names are limited to 8 characters followed by an optional period (.) and extension of up to 3 characters. The characters may be any combination of letters and digits. The following special characters are also allowed:</p>
<p>$ % ' - _ @ ~ ` ! ( ) { } ^ # &amp;</p>
<p>Short names are always converted to upper case and their original case value is lost.</p>
<dl class="section note"><dt>Note</dt><dd>The Arduino Print class uses character at a time writes so it was necessary to use a <a class="el" href="">sync() </a> function to control when data is written to the SD card.</dd></dl>
<dl class="section user"><dt></dt><dd>An application which writes to a file using print(), println() or <a class="el" href="">write() </a> must call <a class="el" href="">sync() </a> at the appropriate time to force data and directory information to be written to the SD Card. Data and directory information are also written to the SD card when <a class="el" href="">close() </a> is called.</dd></dl>
<dl class="section user"><dt></dt><dd>Applications must use care calling <a class="el" href="">sync() </a> since 2048 bytes of I/O is required to update file and directory information. This includes writing the current data block, reading the block that contains the directory entry for update, writing the directory block back and reading back the current data block.</dd></dl>
<p>It is possible to open a file with two or more instances of SdFile. A file may be corrupted if data is written to the file by more than one instance of SdFile.</p>
<h1><a class="anchor" id="References"></a>
References</h1>
<dl class="section see"><dt>See Also</dt><dd></dd></dl>
<p><a href="http://www.vlsi.fi/en/products/vs1053.html">VS1053 Datasheet</a>.</p>
<p><a href="http://www.vsdsp-forum.com/phpbb/index.php">VLSI's DSP support Forum</a>.</p>
<p><a href="http://www.vlsi.fi/en/support/software.html">VLSI's software download of Apps, Patches, Plugins and tools</a>.</p>
<p><a href="http://www.vlsi.fi/fileadmin/app_notes/vlsi/vs10XXan_output.pdf">VS10XX AppNote: Connecting analog outputs</a>.</p>
<p><a href="http://www.sparkfun.com/">Sparkfun Electonics</a></p>
<p><a href="https://www.sparkfun.com/products/10628">MP3 Player Shield DEV-10628</a>.</p>
<p><a href="http://dlnmh9ip6v2uc.cloudfront.net/datasheets/Dev/Arduino/Shields/MP3%20Shield-v13.pdf">SFE's Schematic</a>.</p>
<p><a href="http://www.adafruit.com/">Adafruit Industries:</a>.</p>
<p><a href="http://www.arduino.cc/">The Arduino site</a>.</p>
<p><a href="http://www.atmel.com/dyn/resources/prod_documents/doc8161.pdf">The ATmega328 datasheet</a>.</p>
<h1><a class="anchor" id="Installation"></a>
Installation</h1>
<p>To install, unzip and place '<a class="el" href="class_s_f_e_m_p3_shield.html" title="Interface Driver to the VS10xx chip on the SPI.">SFEMP3Shield</a>', 'SdFat' and 'plugins' folder into your 'C:\{user name}' folder or '{Arduino IDE path}" or {Arduino IDE path}\libraries" directory. Restart the Arduino IDE, and open up the example sketch.</p>
<p>Most of the uses of the library are in the example sketch.</p>
<h1><a class="anchor" id="Error_Codes"></a>
Error_Codes</h1>
<p>From the 'begin' function: </p>
<pre>
0 OK
1 SD Card Init Failure
2 SD Card File System (FAT) init failure
3 SD Card Root Directory init failure
4 MP3 Decoder mode failure
5 MP3 Decoder speed failure
</pre><p>From the 'playTrack' or 'playMP3' function: </p>
<pre>
0 OK
1 Already playing track
2 File not found
</pre><p>From the 'skipTo' function </p>
<pre>
0 OK
1 Not Playing track
2 Failed to skip to new file location
</pre><h1><a class="anchor" id="Plug_Ins"></a>
Plug Ins</h1>
<p>..pl is a perl script that will read and digest the .plg files and convert them to raw binary as to be read by SFEMP3Shield::VSLoadUserCode() from the SdCard. Allowing updates to the VSDsp into its volatile memory after each reset. These updates may be custom features or accumilated patches.</p>
<p>By storing them on the SdCard these plug-ins do not consume the Arduino's limited Flash spaces</p>
<p>Below are pre-compiled binarys of corresponding provided VSLI patches/plugins. The filenames are kept short as SdCard only support 8.3.</p>
<pre>
.\pcm.053       .\vs1053-pcm110\vs1053pcm.plg                 
.\admxleft.053  .\vs1053b-admix130\admix-left.plg             
.\admxmono.053  .\vs1053b-admix130\admix-mono.plg             
.\admxrght.053  .\vs1053b-admix130\admix-right.plg            
.\admxster.053  .\vs1053b-admix130\admix-stereo.plg           
.\admxswap.053  .\vs1053b-admix130\admix-swap.plg             
.\patchesf.053  .\vs1053b-patches195\vs1053b-patches-flac.plg 
.\patches.053   .\vs1053b-patches195\vs1053b-patches.plg      
.\rtmidi.053    .\vs1053b-rtmidistart\rtmidistart.plg         
.\eq5.053       .\vs1053b-eq5-090\vs1053b-eq5.plg        
</pre><p>These plugins should be placed in the root of the SdCard. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Dec 3 2012 22:51:19 for SFEMP3Shield by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
